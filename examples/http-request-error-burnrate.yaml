alerts:
- alert: ErrorBudgetBurn
  annotations:
    message: 'High requests error budget burn for namespace=default,job=fooapp (current
      value: {{ $value }})'
  expr: |
    (
      status_class_5xx:rate_1h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp > (14.4*0.001000)
      and
      status_class_5xx:rate_5m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp > (14.4*0.001000)
    )
    or
    (
      status_class_5xx:rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp > (6*0.001000)
      and
      status_class_5xx:rate_30m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp > (6*0.001000)
    )
  labels:
    severity: critical
- alert: ErrorBudgetBurn
  annotations:
    message: 'High requests error budget burn for namespace=default,job=fooapp (current
      value: {{ $value }})'
  expr: |
    (
      status_class_5xx:rate_1d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{namespace="default",job="fooapp"} > (3*0.001000)
      and
      status_class_5xx:rate_2h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{namespace="default",job="fooapp"} > (3*0.001000)
    )
    or
    (
      status_class_5xx:rate_3d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{namespace="default",job="fooapp"} > (0.001000)
      and
      status_class_5xx:rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{namespace="default",job="fooapp"} > (0.001000)
    )
  labels:
    severity: warning
recordingrule:
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[5m]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_5m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[30m]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_30m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[1h]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_1h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[2h]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_2h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[6h]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[1d]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_1d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum by (status_class) (
      label_replace(
        rate(promhttp_metric_handler_requests_total{namespace="default",job="fooapp"}[3d]
      ), "status_class", "${1}xx", "code", "([0-9])..")
    )
  labels: {}
  record: rate_3d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_5m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_5m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_5m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_30m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_30m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_30m_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_1h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_1h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_1h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_2h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_2h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_2h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_6h_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_1d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_1d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_1d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
- expr: |
    sum(rate_3d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp{status_class="5xx"})
    /
    sum(rate_3d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp)
  labels: {}
  record: status_class_5xx:rate_3d_by_code:promhttp_metric_handler_requests_total:namespace:default:job:fooapp
