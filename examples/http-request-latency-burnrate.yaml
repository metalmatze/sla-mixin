alerts:
- alert: ErrorBudgetBurn
  expr: |
    (
      100 * latency:http_request_duration_seconds_bucket:ratio_rate1h > (14.4*1.000000)
      and
      100* latency:http_request_duration_seconds_bucket:ratio_rate5m > (14.4*1.000000)
    )
    or
    (
      100 * latency:http_request_duration_seconds_bucket:ratio_rate6h > (6*1.000000)
      and
      100 * latency:http_request_duration_seconds_bucket:ratio_rate30m > (6*1.000000)
    )
  labels:
    job: fooapp
    namespace: default
    severity: critical
- alert: ErrorBudgetBurn
  expr: |
    (
      100 * latency:http_request_duration_seconds_bucket:ratio_rate1d > (3*1.000000)
      and
      100 * latency:http_request_duration_seconds_bucket:ratio_rate2h > (3*1.000000)
    )
    or
    (
      100 * latency:http_request_duration_seconds_bucket:ratio_rate3d > (1.000000)
      and
      100 * latency:http_request_duration_seconds_bucket:ratio_rate6h > (1.000000)
    )
  labels:
    job: fooapp
    namespace: default
    severity: warning
recordingrule:
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[5m]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[5m]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate5m
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[30m]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[30m]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate30m
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[1h]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[1h]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate1h
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[2h]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[2h]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate2h
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[6h]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[6h]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate6h
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[1d]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[1d]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate1d
- expr: |
    1 - (
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp",le="1",code!~"5.."}[3d]))
      /
      sum(rate(http_request_duration_seconds_bucket{namespace="default",job="fooapp"}[3d]))
    )
  labels:
    job: fooapp
    namespace: default
  record: latency:http_request_duration_seconds_bucket:ratio_rate3d
